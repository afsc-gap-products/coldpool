---
title: "Cold Pool Index"
author: 
- affiliation: RACE
  description: Research Fish Biologist
  email: Sean.Rohan@noaa.gov
  name: Sean Rohan
output: word_document
fontsize: 12pt
addr: 
  l1: 7600 Sand Point Way NE
  l2: NMFS RACE Division, Groundfish Assessment Program
  l3: Seattle, WA 98115
---

# Cold Pool Index


```{r calc_index, message=FALSE, warning=FALSE, include=FALSE}
library(coldpool)
library(ggrepel)

fig_res <- 300
```

```{r plot_index}
dataset_date <- coldpool:::cold_pool_index$LAST_UPDATE[1]
cpi_sd <- sd(coldpool:::cold_pool_index$AREA_LTE2_KM2)
cpi_mean <- mean(coldpool:::cold_pool_index$AREA_LTE2_KM2)
bt_sd <- sd(coldpool:::cold_pool_index$MEAN_GEAR_TEMPERATURE)
bt_mean <- mean(coldpool:::cold_pool_index$MEAN_GEAR_TEMPERATURE)
sst_sd <- sd(coldpool:::cold_pool_index$MEAN_SURFACE_TEMPERATURE)
sst_mean <- mean(coldpool:::cold_pool_index$MEAN_SURFACE_TEMPERATURE)

cpindex_df <- coldpool:::cold_pool_index %>%
  dplyr::mutate(cpi_dev = (AREA_LTE2_KM2-cpi_mean)/cpi_sd,
                bt_dev = (MEAN_GEAR_TEMPERATURE-bt_mean)/bt_sd,
                sst_dev = (MEAN_SURFACE_TEMPERATURE-sst_mean)/sst_sd,
                cpi_rank = rank(-1*AREA_LTE2_KM2),
                bt_rank = rank(-1*MEAN_GEAR_TEMPERATURE),
                sst_rank = rank(-1*MEAN_SURFACE_TEMPERATURE))

cpindex_df <- coldpool:::cold_pool_index
cpi_sd <- sd(cpindex_df$AREA_LTE2_KM2)
cpi_mean <- mean(cpindex_df$AREA_LTE2_KM2)
cpindex_df <- cpindex_df %>%
  dplyr::mutate(dev = (AREA_LTE2_KM2-cpi_mean)/cpi_sd)

cpa_plot <- ggplot(data = cpindex_df,
             aes(x = YEAR, 
                 y = AREA_LTE2_KM2,
                 label = cpi_rank)) +
  geom_line() +
  geom_point(aes(fill = cut(cpi_dev, c(-3, -2, -1, 1, 2, 3))),
             shape = 21,
             size = rel(3)) +
  ggrepel::geom_text_repel() +
  scale_fill_brewer(name = "Std. dev.", 
                    drop = FALSE, 
                    palette = "RdYlBu",
                    direction = 1) +
  scale_x_continuous(name = "Year") +
  scale_y_continuous(name = expression('Cold Pool Area'~(km^2))) +
  theme_bw()

bt_mean_plot <- ggplot(data = cpindex_df,
             aes(x = YEAR, 
                 y = MEAN_GEAR_TEMPERATURE,
                 label = bt_rank)) +
  geom_line() +
  geom_point(aes(fill = cut(bt_dev, c(-3, -2, -1, 1, 2, 3))),
             shape = 21,
             size = rel(3)) +
    ggrepel::geom_text_repel() +
  scale_fill_brewer(name = "Std. dev.", 
                    drop = FALSE, 
                    palette = "RdYlBu",
                    direction = -1) +
  scale_x_continuous(name = "Year") +
  scale_y_continuous(name = expression('Mean Bottom Temperature'~(degree*C))) +
  theme_bw()

sst_mean_plot <- ggplot(data = cpindex_df,
             aes(x = YEAR, 
                 y = MEAN_SURFACE_TEMPERATURE,
                 label = sst_rank)) +
  geom_line() +
  geom_point(aes(fill = cut(sst_dev, c(-3, -2, -1, 1, 2, 3))),
             shape = 21,
             size = rel(3)) +
    ggrepel::geom_text_repel() +
  scale_fill_brewer(name = "Std. dev.", 
                    drop = FALSE, 
                    palette = "RdYlBu",
                    direction = -1) +
  scale_x_continuous(name = "Year") +
  scale_y_continuous(name = expression('Mean Surface Temperature'~(degree*C))) +
  theme_bw()

png(file = here::here("plots", "cold_pool_area.png"), width = 6, height = 4, res = fig_res, units = "in")
print(cpa_plot)
dev.off()

png(file = here::here("plots", "bottom_temperature_mean.png"), width = 6, height = 4, res = fig_res, units = "in")
print(bt_mean_plot)
dev.off()

png(file = here::here("plots", "surface_temperature_mean.png"), width = 6, height = 4, res = fig_res, units = "in")
print(sst_mean_plot)
dev.off()

coldpool:::cold_pool_index$YEAR[order(coldpool:::cold_pool_index$AREA_LTE2_KM2)]
coldpool:::cold_pool_index$YEAR[order(-1*coldpool:::cold_pool_index$MEAN_GEAR_TEMPERATURE)]
coldpool:::cold_pool_index$YEAR[order(-1*coldpool:::cold_pool_index$MEAN_SURFACE_TEMPERATURE)]
```

Contributed by Sean Rohan^1^ and Lewis Barnett^1^   
^1^ Resource Assessment and Conservation Engineering Division, Alaska Fisheries Science Center, National Marine Fisheries Service, NOAA  
**Contact**: sean.rohan@noaa.gov
**Last updated**:  October 2021

**Description of Indicator**: The cold pool is defined as the area of the southeastern Bering Sea continental shelf with bottom temperature $\leq$ 2&deg;C, in square kilometers.

**Methodological Changes**: In prior years, the cold pool index was calculated based on the area of a polygon defining the threshold of a given temperature derived from an inverse distance weighted interpolation, using a maximum of four observations in the weighting for each prediction. This year, we chose to change the interpolation method. In comparing 10 different interpolation methods with leave-one-out-cross-validation, we found that ordinary kriging with Stein's parameterization of the Matern semivariance structure produced the lowest prediction error in the majority of years. Therefore, this was the method used to estimate cold pool extent for this and all prior years.

**Status and Trends**: The cold pool extent has increased since 2018, yet remains between 1-2 standard deviations below the mean of the time series.  Estimates from 2018 and 2019 were record lows, and the 2021 estimate was only slightly higher than in 2003, which was the record low prior to 2018. 

**Implications**:

**Research Priorities**: